<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Promises</title>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <style>
      .border-box {
        stroke: black;
        fill: none;
      }
      circle {
        fill: red;
        opacity: 0.7;
      }
      .highilight {
        fill: goldenrod;
      }
    </style>
  </head>
  <body>
    <svg></svg>
  </body>
  <script>
    {
      d3.csv(
        "https://gist.githubusercontent.com/curran/a08a1080b88344b0c8a7/raw/639388c2cbc2120a14dcf466e85730eb8be498bb/iris.csv"
      ).then(data => {
        const height = 300;
        const width = 300;
        const padding = 25;

        svg = d3.select("svg");
        svg
          .attr("width", width + 2 * padding)
          .attr("height", height + 2 * padding);

        const plot = svg
          .append("g")
          .attr("transform", `translate(${padding}, ${padding})`);

        const yColumn = "sepal_width";
        const xColumn = "sepal_length";

        const dataset = data.map(d => ({
          x: d[xColumn],
          y: d[yColumn]
        }));

        const [minX, maxX] = [
          d3.min(dataset.map(d => d.x)),
          d3.max(dataset.map(d => d.x))
        ];
        const [minY, maxY] = [
          d3.min(dataset.map(d => d.y)),
          d3.max(dataset.map(d => d.y))
        ];

        const xScale = d3
          .scaleLinear()
          .domain([minX, maxX])
          .range([0, width]);
        const yScale = d3
          .scaleLinear()
          .domain([minY, maxY])
          .range([height, 0]);

        plot
          .append("g")
          .attr("transform", `translate(0, ${height})`)
          .call(d3.axisBottom(xScale));
        plot.append("g").call(d3.axisLeft(yScale));

        const marks = plot.append("g");
        marks
          .selectAll("circle")
          .data(dataset)
          .join("circle")
          .attr("cx", d => xScale(d.x))
          .attr("cy", d => yScale(d.y))
          .attr("r", 3);

        const brushGroup = plot.append("g").classed("brush", true);

        const brush = d3
          .brush()
          .extent([[-10, -10], [width + 10, height + 10]])
          .on("start", () => {
            console.log("Brushing started");
          })
          .on("end", () => {
            console.log("Brushing completed");
          })
          .on("brush", function() {
            console.log(d3.brushSelection(this));
          });
        brushGroup.call(brush);
      });

      function execute() {}
    }
  </script>
  <script src="run.js" charset="utf-8"></script>
</html>
